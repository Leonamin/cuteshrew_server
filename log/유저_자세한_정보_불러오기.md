# 유저 자세한 정보 불러오기
오랜만에 다시 서버를 만지게 되었는데 이렇게 간단한 구조의 서버도 다시 볼 때마다 매번 힘들다.  
클라이언트는 클린 아키텍처 구조를 내가 나름 이해한대로 넣어서 구조는 갖춰져 있는데 아직 서버는 정리도 안되어있고 스키마, 모델도 중구난방으로 되어있다.  
유저에 대한 자세한 정보를 가져오는 방법으로는 /user/search?user_name 형식을 취하도록 하였고 원래는 아마 자기 정보 불러오기 목적으로 해놓았던걸로 기억하는데 자기 정보는 /user/my_page 형식으로 하려고 한다.  

## BaseModel과 Database
이전에 BaseModel 관련해서 정리했던걸로 기억하는데 어디에 뒀는지 까먹어서 다시 정리한다.  
간단히 정리하면 BaseModel의 pydantic은 파싱 라이브러리이며 BaseModel은 들어온 데이터를 파싱해서 출력했을 때 내가 정의한 타입으로 출력해주는 기능을 한다.  
내가 postId: int 같이 변수 필드를 선언하면 얘는 데이터를 파싱해서 int로 출력되거나 에러가 난다.  
그리고 BaseModel을 상속받은 클래스는 from_orm()이란 함수를 사용해서 데이터 베이스 객체들을 알아서 매핑해준다.  
한가지 유의할 점은 Response.from_orm(data_model)를 했을 때 data_model에 Response의 데이터가 없으면 파싱을 못해서 에러가 난다.  
이 때는 Union[None, model]이나 Optional[model]을 써서 파싱을 회피하고(물론 Optioanl 자체가 까보면 Union None로 되어있다.) 생성된 객체에다가 optional한 데이터를 넣으면 된다.  

그리고 다른 더 좋은 방법이 있는지는 모르겠지만 다른 코드 상에서 오히려 응답에서 필드를 지울 때는 객체를 생성한 다음 필드 하나하나에 None 값을 집어넣어서 지웠었다.  

## Session.query()
처음에 FastAPI를 할 때는 자동 매핑이 너무 잘되서 과정이 생략되다보니 코드를 보면 이해를 못했었는데 query()도 그중 하나였다.  
나는 분명 query()...first()로 데이터를 얻어서 리턴했는데 자동으로 json 처리 되는게 어리둥절하고 무슨 과정인지도 몰랐다.
그러다보니 first()로 얻는 데이터도 Any / None로 되어있어서 무슨 형식인지도 몰랐는데 내가 선언한 데이터 모델이 오는 것이다.  
물론 Any로 오기 때문에 자동완성에서는 필드를 알 수 없어서 수동 타이핑을 하거나 캐스팅을 해야한다.